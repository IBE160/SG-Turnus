<story-context id="{bmad_folder}/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.2</storyId>
    <title>user-account-creation</title>
    <status>drafted</status>
    <generatedAt>2025-12-14</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-2-user-account-creation.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>new user</asA>
    <iWant>to create a personal account using my email and a password</iWant>
    <soThat>so that I can have a personalized and secure experience</soThat>
    <tasks>
      <task>
        <title>Frontend - Create Sign Up UI</title>
        <acceptance_criteria>1, 2, 6</acceptance_criteria>
        <subtask>Create a new page/route for /signup.</subtask>
        <subtask>Build the Sign Up form using Material UI components (TextField, Button).</subtask>
        <subtask>Implement form validation for email format and password strength.</subtask>
        <subtask>Display a confirmation message after submission, prompting the user to check their email.</subtask>
      </task>
      <task>
        <title>Backend - Implement Registration Endpoint</title>
        <acceptance_criteria>4, 5, 7</acceptance_criteria>
        <subtask>Create the POST /api/v1/auth/register endpoint in the Python backend.</subtask>
        <subtask>Integrate with the managed authentication provider to create the user.</subtask>
        <subtask>After the auth provider confirms creation, create a corresponding user record in the local PostgreSQL users table.</subtask>
        <subtask>Ensure the password hashing is handled by the managed auth provider.</subtask>
      </task>
      <task>
        <title>Backend - Implement Email Verification</title>
        <acceptance_criteria>5</acceptance_criteria>
        <subtask>Integrate the Resend email service.</subtask>
        <subtask>Trigger the verification email send from the registration endpoint.</subtask>
        <subtask>Create a separate endpoint (e.g., /api/v1/auth/verify-email) to be called when the user clicks the link in the email.</subtask>
      </task>
      <task>
        <title>Testing</title>
        <acceptance_criteria>1-7</acceptance_criteria>
        <subtask>Write unit tests for the frontend form component.</subtask>
        <subtask>Write integration tests for the /api/v1/auth/register backend endpoint.</subtask>
        <subtask>Write an E2E test that simulates the entire sign-up and email verification flow.</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion>Given a user is on the "Sign Up" page</criterion>
    <criterion>When they enter a valid email and a strong password (e.g., 8+ characters, with uppercase, lowercase, number, and special character)</criterion>
    <criterion>And they submit the form</criterion>
    <criterion>Then a new user account is created in the database.</criterion>
    <criterion>And an email is sent to the user with a verification link.</criterion>
    <criterion>And the user is shown a message to check their email for verification.</criterion>
    <criterion>And the password is securely hashed and salted before being stored.</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <artifact>
        <path>docs/prd.md</path>
        <title>The AI Helping Tool - Product Requirements Document</title>
        <section>Functional Requirements</section>
        <snippet>FR9: Account Creation: Users shall be able to create personal accounts via email verification or Single Sign-On (SSO).</snippet>
      </artifact>
      <artifact>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Core Infrastructure</title>
        <section>Services and Modules</section>
        <snippet>Authentication Service (Backend): Handles user registration, email verification, login, and session management.</snippet>
      </artifact>
      <artifact>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Core Infrastructure</title>
        <section>APIs and Interfaces</section>
        <snippet>POST /api/v1/auth/register: Creates a new user account.</snippet>
      </artifact>
      <artifact>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Foundation & Core Infrastructure</title>
        <section>Workflows and Sequencing</section>
        <snippet>1. New User Registration and Verification Workflow</snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Decision Summary</section>
        <snippet>Authentication: Managed Provider (e.g., Auth0, Clerk)</snippet>
      </artifact>
       <artifact>
        <path>docs/ux-design-specification.md</path>
        <title>The AI Helping Tool UX Design Specification</title>
        <section>User Journey: Account Creation &amp; Login</section>
        <snippet>Detailed steps, decision points, error states, success state for user authentication.</snippet>
      </artifact>
    </docs>
    <code>
      <artifact>
        <path>backend/app/api/v1/auth.py</path>
        <kind>api</kind>
        <symbol>register</symbol>
        <reason>Backend API endpoint for handling user registration.</reason>
      </artifact>
      <artifact>
        <path>backend/app/core/auth_service.py</path>
        <kind>service</kind>
        <symbol>create_user</symbol>
        <reason>Core business logic for user creation.</reason>
      </artifact>
      <artifact>
        <path>the-ai-helping-tool/components/auth/SignUpForm.tsx</path>
        <kind>component</kind>
        <symbol>SignUpForm</symbol>
        <reason>Frontend UI component for the user registration form.</reason>
      </artifact>
      <artifact>
        <path>the-ai-helping-tool/services/authService.ts</path>
        <kind>service</kind>
        <symbol>register</symbol>
        <reason>Frontend service for calling the registration API endpoint.</reason>
      </artifact>
    </code>
    <dependencies>
        <ecosystem name="Node.js/npm">
            <package name="next" version="16.0.8"/>
            <package name="react" version="19.2.1"/>
            <package name="react-dom" version="19.2.1"/>
            <package name="@mui/material" version="^7.3.6"/>
        </ecosystem>
        <ecosystem name="Python/pip">
            <package name="fastapi"/>
            <package name="uvicorn"/>
            <package name="pydantic"/>
            <package name="resend"/>
            <package name="email-validator"/>
        </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Use a managed authentication provider (e.g., Auth0, Clerk).</constraint>
    <constraint>Backend is Python (FastAPI), Frontend is Next.js (TypeScript).</constraint>
    <constraint>Database is PostgreSQL.</constraint>
    <constraint>Email service is Resend.</constraint>
    <constraint>All authenticated endpoints must validate a JWT.</constraint>
    <constraint>Data must be encrypted in transit (HTTPS) and at rest.</constraint>
    <constraint>Secrets must be managed via environment variables.</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>Register User</name>
      <kind>REST endpoint</kind>
      <signature>POST /api/v1/auth/register</signature>
      <path>backend/app/api/v1/auth.py</path>
    </interface>
  </interfaces>
  <tests>
    <standards>
    Unit, Integration, and End-to-End (E2E) testing are required. Backend unit tests use Pytest. Frontend unit tests use Jest and React Testing Library. E2E tests use Cypress or Playwright.
    </standards>
    <locations>
      <location>the-ai-helping-tool/components/auth/__tests__/</location>
      <location>backend/tests/</location>
      <location>the-ai-helping-tool/cypress/e2e/</location>
    </locations>
    <ideas>
      <idea ac_id="1,2,6">Unit test the SignUpForm component for correct rendering and validation logic.</idea>
      <idea ac_id="4,5,7">Integration test the POST /api/v1/auth/register endpoint to verify user creation and email dispatch.</idea>
      <idea ac_id="1-7">Write an E2E test for the full sign-up flow.</idea>
    </ideas>
  </tests>
</story-context>